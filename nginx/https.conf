server {
		listen 443 default;

                access_log      /var/log/nginx/vm4122-ssl.access_log;
                error_log       /var/log/nginx/vm4122-ssl.error_log;

                ssl on;
                ssl_certificate /etc/nginx/weixin.07law.com.crt;
                ssl_certificate_key /etc/nginx/weixin.07law.com.key;

                ssl_session_timeout 5m;

                ssl_protocols SSLv3 TLSv1;
                ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
                ssl_prefer_server_ciphers on;
		return         301 http://$host$request_uri;
}

server {
                listen 443;
                server_name home.07law.com;

                access_log      /var/log/nginx/vm2102-ssl.access_log;
                error_log       /var/log/nginx/vm2102-ssl.error_log;

                ssl on;
                ssl_certificate /etc/nginx/home.07law.com.crt;
                ssl_certificate_key /etc/nginx/home.07law.com.key;

                ssl_session_timeout 5m;

                ssl_protocols SSLv3 TLSv1;
                ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
                ssl_prefer_server_ciphers on;
                location /websocket {
                        proxy_pass        http://10.10.2.102:8080/websocket;
                        proxy_read_timeout 60s;
                        proxy_redirect off;
                        proxy_http_version 1.1;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection "upgrade";
                        proxy_set_header   Host             $host;
                        proxy_set_header   X-Real-IP        $remote_addr;
                        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
                }


                location / {
                        proxy_pass        http://10.10.2.102:8080;
                        proxy_set_header   Host             $host;
                        proxy_set_header   X-Real-IP        $remote_addr;
                        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
                        proxy_set_header X-Forwarded-Proto https;
                        proxy_set_header X-Url-Scheme $scheme;
                }
                include /etc/nginx/custom-error-pages.conf;
        }

server {
    listen       443 ssl;
    server_name  chat.homolo.org;

    ssl_certificate      /etc/nginx/chat.homolo.org.cert.crt;
    ssl_certificate_key  /etc/nginx/chat.homolo.org.cert.key;

    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout  5m;

    ssl_ciphers  HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers   on;
    location / {
            proxy_pass        http://localhost:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $http_host;
    
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forward-Proto http;
            proxy_set_header X-Nginx-Proxy true;
            proxy_redirect off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    }
}

server {
    listen       443 ssl;
    server_name  git.homolo.org;

    ssl_certificate      /etc/nginx/git.homolo.org.cert.crt;
    ssl_certificate_key  /etc/nginx/git.homolo.org.cert.key;

    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout  5m;

    ssl_ciphers  HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers   on;
    location / {
            proxy_pass        http://10.10.4.125;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Proto https;
            proxy_set_header   X-Forwarded-Protocol https;
            proxy_set_header   X-Forwarded-Ssl on;
            proxy_set_header   X-Url-Scheme $scheme;
    }
}
